<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kancelářská Kartotéka - Pccorporation v1.8 (App Widgets - Complete & Fixed)</title>
  <!-- Font pro retro vzhled -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Orbitron:wght@400..900&display=swap" rel="stylesheet">
  <!-- <link rel="stylesheet" href="styles.css"> -->
  <style>
    :root {
       /* Základní Retro Barvy */
      --retro-glow-color: rgba(0, 255, 255, 0.7); --retro-glow-color-strong: rgba(0, 255, 255, 1); --retro-text-color: #00ffff; --retro-bg-color: #000; --retro-border-color: #00ffff; --retro-accent-color: #ff0066; --retro-accent-hover-color: #ff6600;
      /* Neon / Matrix Barvy */
      --neon-green: #00ff00; --neon-green-glow: rgba(0, 255, 0, 0.6); --neon-blue: #00ccff; --neon-blue-glow: rgba(0, 204, 255, 0.6); --neon-pink: #ff00ff; --neon-pink-glow: rgba(255, 0, 255, 0.6); --neon-yellow: #ffff00; --neon-yellow-glow: rgba(255, 255, 0, 0.6); --neon-red: #ff1111; --neon-red-glow: rgba(255, 17, 17, 0.6); --matrix-bg: #020402;
      /* Písmo */
      --font-pixel: 'VT323', 'Courier New', monospace; --font-tech: 'Orbitron', sans-serif; --font-main: 'Arial', sans-serif;
    }
    body { background-color: #0a0a0a; font-family: var(--font-pixel); margin: 0; padding: 0; color: white; min-height: 100vh; overflow: hidden; padding-bottom: 40px; position: relative; padding-top: 80px; /* Větší padding nahoře pro app widgety */}
    /* --- Matrix Rain Pozadí --- */
    #matrix-rain-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.3; background-color: var(--matrix-bg); display: block; }
    /* --- Styly pro přetahovatelné a měnitelné widgety --- */
    .widget { position: fixed; cursor: move; z-index: 90; margin: 5px; user-select: none; background-color: rgba(10, 10, 10, 0.7); backdrop-filter: blur(3px); border-radius: 5px; padding: 10px; box-shadow: 0 0 8px rgba(128, 128, 128, 0.3); overflow: hidden; min-width: 100px; min-height: 50px; display: flex; flex-direction: column; }
    .widget.dragging { z-index: 105; opacity: 0.8; cursor: grabbing; }
    .widget .no-drag, .widget canvas, .widget .editor-output, #crt-content, #note-textarea, .settings-submenu *, .icon, input, select, button:not(.close-button):not(.widget-resize-handle), textarea, .status-item, .fan-assembly-new, .app-icon-content { cursor: default; user-select: text; }
    .widget-header { font-family: var(--font-tech); font-size: 14px; color: #aaa; text-align: center; margin-bottom: 8px; padding-bottom: 5px; border-bottom: 1px solid #444; text-transform: uppercase; letter-spacing: 1px; cursor: move; flex-shrink: 0; }
    .widget-content { flex-grow: 1; position: relative; display: flex; flex-direction: column; }
    .widget-resize-handle { position: absolute; bottom: 0; right: 0; width: 15px; height: 15px; background: linear-gradient(135deg, transparent 50%, rgba(255,255,255,0.3) 50%); cursor: nwse-resize; z-index: 91; border-top: 1px solid rgba(255,255,255,0.2); border-left: 1px solid rgba(255,255,255,0.2); }
    .widget.no-resize .widget-resize-handle { display: none; }
    /* Skrývání widgetů přes třídu */
    .widget.hidden { display: none; }


    /* --- STYLY PRO KALENDÁŘ (beze změny) --- */
    #calendar-bar { position: fixed; top: 15px; left: 15px; background-color: var(--retro-bg-color); border: 2px solid var(--retro-border-color); padding: 5px 15px; border-radius: 3px; color: var(--retro-text-color); font-size: 20px; cursor: pointer; z-index: 101; box-shadow: 0 0 8px var(--retro-glow-color); transition: background-color 0.3s, box-shadow 0.3s; white-space: nowrap; } #calendar-bar:hover { background-color: #111; box-shadow: 0 0 12px var(--retro-glow-color-strong); } #calendar-widget { display: none; position: fixed; top: 55px; left: 15px; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(3px); border: 2px solid var(--retro-border-color); border-radius: 5px; padding: 15px; z-index: 102; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); color: var(--retro-text-color); width: 300px; font-size: 18px; } #calendar-widget.visible { display: block; } .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 22px; } .calendar-header button { background: none; border: 1px solid var(--retro-text-color); color: var(--retro-text-color); font-family: var(--font-pixel); font-size: 20px; cursor: pointer; padding: 0 5px; border-radius: 3px; } .calendar-header button:hover { background-color: #222; } .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; } .calendar-grid div { padding: 5px; border-radius: 3px; } .day-name { font-weight: bold; color: var(--retro-accent-hover-color); } .day { cursor: pointer; border: 1px solid transparent; } .day:hover { background-color: #333; border-color: var(--retro-text-color); } .day.other-month { color: #555; cursor: default; } .day.other-month:hover { background-color: transparent; border-color: transparent; } .day.today { background-color: var(--retro-accent-hover-color); color: var(--retro-bg-color); border-color: var(--retro-accent-hover-color); } .day.today:hover { background-color: var(--retro-accent-color); } .day.selected { border-color: var(--retro-text-color); background-color: #444; box-shadow: 0 0 5px var(--retro-glow-color); } #notes-section { display: none; margin-top: 15px; border-top: 1px dashed var(--retro-border-color); padding-top: 10px; } #notes-section.visible { display: block; } #notes-section h4 { margin: 0 0 10px 0; font-size: 20px; color: var(--retro-accent-hover-color); } #note-textarea { width: calc(100% - 12px); height: 80px; background-color: #111; border: 1px solid var(--retro-border-color); color: var(--retro-text-color); font-family: var(--font-pixel); font-size: 16px; padding: 5px; margin-bottom: 10px; border-radius: 3px; resize: vertical; } #save-note-btn { background-color: var(--retro-accent-color); color: white; border: none; padding: 8px 15px; cursor: pointer; font-size: 16px; font-family: var(--font-pixel); border-radius: 3px; transition: background-color 0.3s; } #save-note-btn:hover { background-color: var(--retro-accent-hover-color); }
    /* --- CRT Terminal --- */
    #crt-terminal { top: 80px; left: 15px; width: 300px; height: 180px; border: 10px solid #1c1c1c; border-radius: 15px 15px 25px 25px / 15px 15px 35px 35px; box-shadow: inset 0 0 15px rgba(0,0,0,0.7), 0 0 10px var(--neon-green-glow); padding: 0; color: var(--neon-green); font-size: 16px; background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px); background-size: 100% 3px; animation: flicker 0.15s infinite; min-height: 100px; } #crt-terminal .widget-header { display: none; } #crt-terminal .widget-content { padding: 10px 15px 0 15px; justify-content: space-between; } #crt-terminal::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: inherit; box-shadow: inset 0 0 50px rgba(0,0,0,0.5); pointer-events: none; } @keyframes flicker { 0%, 100% { opacity: 1; } 50% { opacity: 0.95; } } #crt-content { height: 100%; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--neon-green) #080808; margin-bottom: 5px; } #crt-content p { margin: 0 0 3px 0; line-height: 1.2; } #crt-status-line { display: flex; justify-content: space-between; align-items: center; font-size: 16px; text-shadow: 0 0 5px var(--neon-green-glow); padding-top: 5px; border-top: 1px solid rgba(0, 255, 0, 0.2); flex-shrink: 0; padding: 5px 15px 10px 15px; } #crt-terminal::after { content: ''; position: absolute; width: 6px; height: 6px; background: #555; border-radius: 50%; box-shadow: 0 0 2px black; top: 8px; right: 8px; }
    /* --- Staré Měřáky (no-resize) --- */
    #gauge-cluster { bottom: 50px; left: 15px; display: flex; /* Zajištěno widget třídou */ gap: 15px; padding: 10px; border: 1px solid #444; box-shadow: 0 0 8px var(--neon-yellow-glow); min-width: initial; min-height: initial; flex-direction: column; /* Header nad gauges */} #gauge-cluster .widget-header { margin-bottom: 5px; width: 100%; padding-bottom: 3px;} #gauge-cluster .widget-content { display: flex; flex-direction: row; /* Gauges vedle sebe */ gap: 15px; } .gauge { width: 80px; text-align: center; } .gauge-label { font-size: 14px; color: var(--neon-yellow); margin-bottom: 5px; text-shadow: 0 0 3px var(--neon-yellow-glow); } .gauge-bar-container { height: 100px; background-color: #111; border: 1px solid #444; border-radius: 3px; position: relative; overflow: hidden; } .gauge-bar { position: absolute; bottom: 0; left: 0; width: 100%; background-color: var(--neon-yellow); box-shadow: 0 0 8px var(--neon-yellow-glow); transition: height 0.5s ease-out; height: 0%; } .gauge-value { margin-top: 5px; font-size: 16px; color: white; }
    /* --- Osciloskop --- */
    #oscilloscope { bottom: 190px; right: 15px; width: 200px; height: 120px; border: 2px solid var(--neon-green); box-shadow: 0 0 10px var(--neon-green-glow); padding: 0; } #oscilloscope .widget-header { padding: 5px 10px 0 10px; margin-bottom: 0; } #oscilloscope .widget-content { padding: 0; } #osc-canvas { display: block; width: 100%; height: 100%; background-image: linear-gradient(rgba(0, 255, 0, 0.15) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 0, 0.15) 1px, transparent 1px); background-size: 15px 15px; } #oscilloscope::before { content: 'FREQ'; position: absolute; top: 2px; left: 5px; font-size: 10px; color: var(--neon-green); opacity: 0.7; pointer-events: none; } #oscilloscope::after { content: 'AMPL'; position: absolute; bottom: 2px; left: 5px; font-size: 10px; color: var(--neon-green); opacity: 0.7; pointer-events: none; }
    /* --- Pixel Hodiny (no-resize) --- */
    #pixel-clock { top: 15px; right: 180px; font-size: 36px; color: var(--neon-yellow); text-shadow: 0 0 8px var(--neon-yellow-glow); background-color: rgba(0, 0, 0, 0.6); padding: 5px 10px; line-height: 1; border: 1px solid var(--neon-yellow); white-space: nowrap; min-width: initial; min-height: initial; display: block; height: auto; }
    /* --- Ticker (není widget) --- */
    #ticker-bar { position: fixed; bottom: 0; left: 0; width: 100%; height: 30px; background-color: #111; border-top: 2px solid var(--retro-accent-hover-color); box-shadow: 0 -2px 10px rgba(255, 102, 0, 0.5); overflow: hidden; z-index: 95; } #ticker-content { display: inline-block; padding-left: 100%; white-space: nowrap; line-height: 30px; font-size: 18px; color: var(--ticker-text-color); animation: scroll-ticker 30s linear infinite; } @keyframes scroll-ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    /* --- Status Light (není widget) --- */
    .status-light { position: fixed; top: 25px; right: 70px; width: 15px; height: 15px; border-radius: 50%; background-color: red; box-shadow: 0 0 10px rgba(255, 0, 0, 0.8); animation: blink-light 1.5s infinite steps(1, end); z-index: 100; } @keyframes blink-light { 0%, 100% { background-color: #ff0000; box-shadow: 0 0 10px rgba(255, 0, 0, 0.8); } 50% { background-color: #550000; box-shadow: 0 0 3px rgba(100, 0, 0, 0.5); } }

    /* ----- IKONY APLIKACÍ JAKO WIDGETY ----- */
    .app-widget { width: 100px; height: 60px; min-width: 80px; min-height: 40px; padding: 5px; border: 1px solid var(--neon-blue); box-shadow: 0 0 8px var(--neon-blue-glow); background: linear-gradient(145deg, rgba(0, 50, 100, 0.4), rgba(0, 20, 50, 0.6)); cursor: pointer; text-align: center; display: flex; justify-content: center; align-items: center; transition: transform 0.2s ease, box-shadow 0.2s ease; flex-direction: row; }
    .app-widget:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--neon-blue-glow); }
    .app-widget .widget-header { display: none; }
    .app-icon-content { font-family: var(--font-pixel); font-size: 20px; color: var(--neon-blue); text-shadow: 0 0 5px var(--neon-blue-glow); width: 100%; text-align: center; }
    .app-icon-content span { display: block; font-size: 12px; margin-top: 3px; color: #ccc; text-shadow: none; }
    /* Výchozí pozice pro app widgety */
    #widget-inventar { top: 10px; left: 200px; } #widget-projekty { top: 10px; left: 320px; } #widget-trezor   { top: 10px; left: 440px; } #widget-dokumenty{ top: 10px; left: 560px; } #widget-editor   { top: 10px; left: 680px; }

    /* ----- TEXTOVÝ EDITOR (MODAL) ----- */
    #editor-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 110; justify-content: center; align-items: center; } #editor-modal.visible { display: flex; } .editor-container { position: relative; background: #1a1a1a; padding: 25px; border-radius: 10px; width: 90%; max-width: 900px; box-shadow: 0 0 25px var(--neon-pink-glow); border: 2px solid var(--neon-pink); font-family: var(--font-main); color: white; cursor: default; } .editor-container .close-button { position: absolute; top: 10px; right: 15px; background: none; border: none; color: var(--neon-pink); font-size: 28px; font-family: var(--font-pixel); cursor: pointer; } .editor-container .close-button:hover { color: white; } .editor-toolbar select, .editor-toolbar button { margin: 5px; padding: 5px; font-family: var(--font-main); background-color: #333; color: white; border: 1px solid #555; cursor: pointer; } .editor-output { min-height: 200px; padding: 10px; background: #101010; margin-top: 10px; color: white; border: 1px solid #444; font-family: var(--font-main); } #editor[contenteditable="true"] { font-family: initial; } .save-button { margin-top: 10px; padding: 10px; background-color: var(--neon-pink); color: black; font-weight: bold; border: none; cursor: pointer; font-size: 16px; font-family: var(--font-main); transition: background-color 0.3s; } .save-button:hover { background-color: var(--retro-accent-color); color: white; } .save-as-container { margin-top: 20px; font-family: var(--font-main); } .save-as-container input { font-family: var(--font-main); padding: 5px; background: #333; border: 1px solid #555; color: white; }
    /* ----- MENU NASTAVENÍ ----- */
    .settings-icon { position: fixed; top: 20px; right: 20px; font-size: 30px; cursor: pointer; color: var(--neon-yellow); z-index: 100; font-family: sans-serif; filter: drop-shadow(0 0 5px var(--neon-yellow-glow)); } .settings-menu { display: none; position: fixed; top: 60px; right: 20px; background-color: rgba(10, 10, 10, 0.85); backdrop-filter: blur(4px); padding: 20px; border-radius: 10px; box-shadow: 0 0 20px var(--neon-yellow-glow); border: 1px solid var(--neon-yellow); z-index: 103; font-family: var(--font-main); width: 280px; } .settings-menu.open { display: block; } .settings-menu h3 { font-family: var(--font-tech); color: var(--neon-yellow); margin-top: 0; text-align: center; } .settings-menu > button { background-color: #333; border: 1px solid #555; color: var(--neon-yellow); padding: 12px; margin: 10px 0; cursor: pointer; width: 100%; font-size: 16px; font-family: var(--font-tech); transition: background-color 0.3s, color 0.3s; text-align: left; } .settings-menu > button:hover { background-color: var(--neon-yellow); color: black; } .settings-submenu { display: none; background-color: rgba(20, 20, 20, 0.8); padding: 15px; margin-top: -10px; margin-bottom: 10px; border: 1px solid #444; border-top: none; border-radius: 0 0 5px 5px; } .settings-submenu.open { display: block; } .settings-submenu label { display: block; margin-bottom: 8px; color: #ccc; } .settings-submenu input[type="checkbox"], .settings-submenu input[type="radio"] { margin-right: 8px; accent-color: var(--neon-yellow); cursor: pointer; } .settings-submenu select { background: #333; color: white; border: 1px solid #555; padding: 3px; cursor: pointer; } .settings-submenu button { background-color: #444; color: white; border: 1px solid #666; padding: 8px 12px; cursor: pointer; transition: background-color 0.3s; } .settings-submenu button:hover { background-color: #555; } .settings-submenu p { color: #aaa; font-size: 14px; }

    /* ----- STARŠÍ NEONOVÉ WIDGETY ----- */
    /* Neon Voltage Meter */
    #voltage-meter { bottom: 50px; right: 230px; width: 150px; border: 2px solid var(--neon-pink); box-shadow: 0 0 15px var(--neon-pink-glow); color: var(--neon-pink); font-family: var(--font-tech); min-height: 140px; } #voltage-meter .widget-content { padding-top: 5px; } #voltage-meter h4 { margin: 0 0 10px 0; text-align: center; font-size: 16px; text-shadow: 0 0 5px var(--neon-pink-glow); } .voltage-line { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 18px; } .voltage-label { opacity: 0.8; } .voltage-value { font-weight: bold; text-shadow: 0 0 3px var(--neon-pink-glow); }

    /* **** VYLEPŠENÝ VĚTRÁČEK v1.8 **** */
    #fan-widget { bottom: 180px; right: 270px; width: 120px; height: 135px; border: 3px solid #555; border-radius: 6px; box-shadow: 0 0 15px var(--neon-blue-glow), inset 0 0 8px rgba(0,0,0,0.6); background-color: #1a1a1a; display: flex; flex-direction: column; justify-content: space-between; align-items: center; position: relative; min-width: 90px; min-height: 110px; padding: 5px; }
    #fan-widget .widget-header { margin-bottom: 5px; padding-bottom: 3px; }
    .fan-visuals { width: 80px; height: 80px; position: relative; margin-bottom: 5px; flex-shrink: 0; background: radial-gradient(circle, #222 40%, #111 70%); border-radius: 50%; border: 1px solid #444; }
    #fan-widget::after { content: ''; position: absolute; top: 45%; left: 50%; width: 65px; height: 65px; border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 15px 5px var(--neon-blue-glow), inset 0 0 10px 2px rgba(0, 204, 255, 0.3); pointer-events: none; z-index: 91; opacity: 0.6; }
    .fan-assembly-new { width: 100%; height: 100%; position: relative; animation: spin-fan-new 1.1s linear infinite; z-index: 92; }
    .fan-hub-new { position: absolute; top: 50%; left: 50%; width: 22%; height: 22%; background: radial-gradient(circle, #667 20%, #333 80%); border-radius: 50%; transform: translate(-50%, -50()); border: 2px solid #889; box-shadow: 0 0 8px rgba(0, 0, 0, 0.7); }
    .fan-blade-new { position: absolute; top: 0; left: 40%; width: 20%; height: 55%; background: linear-gradient(to bottom, #687a85, #40515a); transform-origin: 50% 100%; clip-path: polygon(15% 0%, 85% 0%, 100% 100%, 0% 100%); border-top: 1px solid #9ab; outline: 1px solid rgba(0, 204, 255, 0.3); }
    .fan-blade-new:nth-child(1) { transform: translateY(-10%) rotate(0deg); } .fan-blade-new:nth-child(2) { transform: translateY(-10%) rotate(72deg); } .fan-blade-new:nth-child(3) { transform: translateY(-10%) rotate(144deg); } .fan-blade-new:nth-child(4) { transform: translateY(-10%) rotate(216deg); } .fan-blade-new:nth-child(5) { transform: translateY(-10%) rotate(288deg); }
    @keyframes spin-fan-new { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    #fan-rpm { font-family: var(--font-tech); font-size: 16px; color: var(--neon-blue); text-shadow: 0 0 5px var(--neon-blue-glow); text-align: center; width: 100%; flex-shrink: 0; margin-top: auto; padding-top: 5px; border-top: 1px solid #444; }
    /* **** KONEC VYLEPŠENÉHO VĚTRÁČKU **** */


    /* USB Slots Widget (no-resize) */
    #usb-slots { bottom: 50px; left: 300px; display: flex; flex-direction: column; gap: 15px; border: 1px solid #555; min-width: initial; min-height: initial; }
    .usb-slot-container { display: flex; align-items: center; gap: 10px; }
    .usb-slot { width: 60px; height: 20px; border: 2px solid #444; background-color: #1a1a1a; border-radius: 3px; display: flex; align-items: center; justify-content: center; transition: border-color 0.3s, background-color 0.3s; cursor: pointer; flex-shrink: 0; }
    .usb-slot::before { content: ''; display: block; width: 80%; height: 60%; background-color: #050505; border-radius: 1px; }
    .usb-slot.occupied { border-color: var(--neon-green); background-color: #102010; }
    .usb-slot.occupied::before { background-color: var(--neon-green); box-shadow: 0 0 5px var(--neon-green-glow); }
    .usb-label { color: var(--neon-green); font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 120px; text-shadow: 0 0 3px var(--neon-green-glow); display: none; }
    .usb-link { color: var(--neon-green); text-decoration: none; margin-left: 5px; display: none; opacity: 0.7; transition: opacity 0.3s; } .usb-link:hover { opacity: 1; text-decoration: underline; }
    .usb-slot.occupied + .usb-label { display: inline; }
    .usb-slot.occupied + .usb-label + .usb-link { display: inline; }

    /* ===== NOVÉ WIDGETY v1.5 ===== */
    /* Scratchpad Widget */
    #scratchpad-widget { top: 80px; right: 15px; width: 250px; height: 180px; border: 2px solid var(--neon-yellow); box-shadow: 0 0 10px var(--neon-yellow-glow); min-height: 100px; } #scratchpad-widget .widget-content { padding: 5px; }
    #scratchpad-textarea { flex-grow: 1; background-color: #111; border: none; color: var(--neon-yellow); font-family: var(--font-pixel); font-size: 16px; padding: 8px; margin-bottom: 5px; resize: none; outline: none; height: 100%; }
    #scratchpad-clear-btn { background-color: #444; color: var(--neon-yellow); border: 1px solid #666; padding: 5px 10px; cursor: pointer; font-family: var(--font-pixel); font-size: 14px; transition: background-color 0.3s; align-self: flex-end; flex-shrink: 0; }
    #scratchpad-clear-btn:hover { background-color: #555; }

    /* Unit Converter Widget */
    #converter-widget { top: 300px; left: 15px; width: 300px; border: 2px solid var(--neon-pink); box-shadow: 0 0 10px var(--neon-pink-glow); color: var(--neon-pink); min-width: 250px; }
    #converter-widget .widget-content { padding: 5px; }
    .converter-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; flex-wrap: wrap; }
    .converter-row input[type="number"] { width: 80px; background-color: #111; border: 1px solid #444; color: var(--neon-pink); font-family: var(--font-pixel); font-size: 16px; padding: 5px; text-align: right; outline: none; appearance: textfield; margin: 2px; }
    .converter-row input[type="number"]::-webkit-outer-spin-button, .converter-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .converter-row select { background-color: #333; border: 1px solid #555; color: var(--neon-pink); font-family: var(--font-pixel); font-size: 14px; padding: 4px; outline: none; margin: 2px; }
    .converter-equals { font-size: 18px; margin: 0 5px; }
    #converter-type { width: calc(100% - 0px); margin-bottom: 15px; background-color: #333; border: 1px solid #555; color: var(--neon-pink); font-family: var(--font-pixel); padding: 4px; }
    #converter-error { color: var(--neon-red); font-size: 12px; text-align: center; height: 15px; }

    /* Status Panel Widget */
    #status-panel-widget { top: 300px; right: 15px; width: 250px; border: 2px solid var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue-glow); color: var(--neon-blue); min-height: 150px; }
    #status-items-container { overflow-y: auto; max-height: calc(100% - 35px); padding-right: 5px; }
    .status-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 16px; }
    .status-label { opacity: 0.8; flex-shrink: 0; margin-right: 10px; }
    .status-indicator { font-family: var(--font-tech); font-weight: bold; padding: 2px 6px; border-radius: 3px; font-size: 12px; min-width: 60px; text-align: center; }
    /* Stavy */
    .status-ok, .status-online, .status-active { background-color: rgba(0, 255, 0, 0.2); color: var(--neon-green); text-shadow: 0 0 3px var(--neon-green-glow); } .status-warn, .status-idle { background-color: rgba(255, 255, 0, 0.2); color: var(--neon-yellow); text-shadow: 0 0 3px var(--neon-yellow-glow); } .status-error, .status-offline { background-color: rgba(255, 17, 17, 0.2); color: var(--neon-red); text-shadow: 0 0 3px var(--neon-red-glow); animation: blink-error 1s infinite; } @keyframes blink-error { 50% { opacity: 0.5; } }

  </style>
</head>
<body>

  <canvas id="matrix-rain-canvas"></canvas>

  <!-- FIXNÍ PRVKY -->
  <div id="calendar-bar" title="Zobrazit/skrýt kalendář"></div>
  <div id="calendar-widget"> <div class="calendar-header"> <button id="prev-month"><</button> <span id="month-year"></span> <button id="next-month">></button> </div> <div class="calendar-grid" id="calendar-days"> <div class="day-name">PO</div> <div class="day-name">ÚT</div> <div class="day-name">ST</div> <div class="day-name">ČT</div> <div class="day-name">PÁ</div> <div class="day-name">SO</div> <div class="day-name">NE</div> </div> <div id="notes-section"> <h4 id="notes-header">Poznámky pro:</h4> <textarea id="note-textarea" class="no-drag" placeholder="Zapiš poznámku..."></textarea> <button id="save-note-btn">Uložit poznámku</button> </div> </div>
  <div id="ticker-bar"> <div id="ticker-content"> // SYSTEM STATUS: OPERATIONAL // CORE VOLTAGES: STABLE // USB PORTS: ACTIVE // FAN SPEED: NOMINAL // MATRIX CONNECTION: SECURE // LAB ACCESS GRANTED // USER: ELEKTROMECHANIK // </div> </div>
  <div class="settings-icon" onclick="toggleSettingsMenu()">⚙️</div>
  <div id="settingsMenu" class="settings-menu"> <h3>Nastavení</h3> <button onclick="toggleSubmenu('appearance-settings')">Vzhled</button> <div id="appearance-settings" class="settings-submenu"> <label>Téma:</label> <label><input type="radio" name="theme" value="dark" checked> Tmavé Neon</label> <label><input type="radio" name="theme" value="light"> Světlé</label> <label for="accent-color">Hlavní barva (Neon):</label> <select id="accent-color"> <option value="blue" selected>Modrá</option> <option value="green">Zelená</option> <option value="pink">Růžová</option> <option value="yellow">Žlutá</option> </select> </div> <button onclick="toggleSubmenu('widget-settings')">Widgety</button> <div id="widget-settings" class="settings-submenu"> <label><input type="checkbox" id="show-crt" checked onchange="toggleWidgetVisibility('crt-terminal', this.checked)"> Zobrazit CRT Terminál</label> <label><input type="checkbox" id="show-gauges" checked onchange="toggleWidgetVisibility('gauge-cluster', this.checked)"> Zobrazit Měřáky (Staré)</label> <label><input type="checkbox" id="show-osc" checked onchange="toggleWidgetVisibility('oscilloscope', this.checked)"> Zobrazit Osciloskop</label> <label><input type="checkbox" id="show-volt" checked onchange="toggleWidgetVisibility('voltage-meter', this.checked)"> Zobrazit Měřák Napětí</label> <label><input type="checkbox" id="show-fan" checked onchange="toggleWidgetVisibility('fan-widget', this.checked)"> Zobrazit Větráček</label> <label><input type="checkbox" id="show-usb" checked onchange="toggleWidgetVisibility('usb-slots', this.checked)"> Zobrazit USB Sloty</label> <label><input type="checkbox" id="show-scratchpad" checked onchange="toggleWidgetVisibility('scratchpad-widget', this.checked)"> Zobrazit Scratchpad</label> <label><input type="checkbox" id="show-converter" checked onchange="toggleWidgetVisibility('converter-widget', this.checked)"> Zobrazit Převodník</label> <label><input type="checkbox" id="show-status" checked onchange="toggleWidgetVisibility('status-panel-widget', this.checked)"> Zobrazit Status Panel</label> <label><input type="checkbox" id="show-matrix" checked onchange="toggleWidgetVisibility('matrix-rain-canvas', this.checked)"> Zobrazit Matrix Efekt</label> </div> <button onclick="toggleSubmenu('data-settings')">Data & Úložiště</button> <div id="data-settings" class="settings-submenu"> <label>Poznámky v kalendáři:</label> <button onclick="clearCalendarNotes()">Vymazat všechny poznámky</button> <label style="margin-top: 10px;">Scratchpad:</label> <button onclick="clearScratchpad()">Vymazat Scratchpad</button> <label style="margin-top: 10px;">Pozice & Velikosti widgetů:</label> <button onclick="resetWidgetState()">Resetovat widgety</button> </div> <button onclick="toggleSubmenu('about-settings')">O Aplikaci</button> <div id="about-settings" class="settings-submenu"> <p>Neon Laboratoř Dashboard v1.8</p> <p>Vytvořeno pro Elektromechanika</p> <p>© 2024</p> </div> </div>
  <div class="status-light" title="System Status"></div>

  <!-- WIDGETY APLIKACÍ (nahoře, přetahovatelné, no-resize) -->
  <div id="widget-inventar" class="widget app-widget no-resize" onclick="window.location.href='/home/pi/kancelar/inventar'"> <div class="app-icon-content no-drag">[INV]<span>Inventář</span></div> </div>
  <div id="widget-projekty" class="widget app-widget no-resize" onclick="window.location.href='/home/pi/kancelar/projekty'"> <div class="app-icon-content no-drag">[PRJ]<span>Projekty</span></div> </div>
  <div id="widget-trezor"   class="widget app-widget no-resize" onclick="window.location.href='/home/pi/kancelar/trezor'"> <div class="app-icon-content no-drag">[*]<span>Trezor</span></div> </div>
  <div id="widget-dokumenty"class="widget app-widget no-resize" onclick="window.location.href='/home/pi/kancelar/dokumenty'"> <div class="app-icon-content no-drag">[DOC]<span>Dokumenty</span></div> </div>
  <div id="widget-editor"   class="widget app-widget no-resize" onclick="toggleEditorModal()"> <div class="app-icon-content no-drag">[/]<span>Editor</span></div> </div>


  <!-- OSTATNÍ PŘETAHATELNÉ A MĚNITELNÉ WIDGETY -->
  <div id="crt-terminal" class="widget">
      <!-- Header se zde nerenderuje -->
      <div class="widget-content">
          <div id="crt-content" class="no-drag"></div>
          <div id="crt-status-line">
              <span id="crt-date">--.--.----</span>
              <span id="crt-time">--:--:--</span>
          </div>
      </div>
      <div class="widget-resize-handle"></div>
  </div>
  <div id="gauge-cluster" class="widget no-resize">
    <div class="widget-header">Legacy Gauges</div>
    <div class="widget-content">
        <div class="gauge"> <div class="gauge-label">CORE TEMP</div> <div class="gauge-bar-container no-drag"><div class="gauge-bar" id="gauge-temp"></div></div> <div class="gauge-value" id="gauge-temp-value">--°C</div> </div>
        <div class="gauge"> <div class="gauge-label">ENERGY LVL</div> <div class="gauge-bar-container no-drag"><div class="gauge-bar" id="gauge-energy"></div></div> <div class="gauge-value" id="gauge-energy-value">--%</div> </div>
        <div class="gauge"> <div class="gauge-label">SIGNAL STR</div> <div class="gauge-bar-container no-drag"><div class="gauge-bar" id="gauge-signal"></div></div> <div class="gauge-value" id="gauge-signal-value">--dB</div> </div>
    </div>
  </div>
  <div id="oscilloscope" class="widget"> <div class="widget-header">Signal Scope</div> <div class="widget-content"><canvas id="osc-canvas" class="no-drag"></canvas></div> <div class="widget-resize-handle"></div> </div>
  <div id="pixel-clock" class="widget no-resize">--:--:--</div>
  <div id="voltage-meter" class="widget"> <div class="widget-header">Core Voltage</div> <div class="widget-content"> <h4>SYSTEM RAILS</h4> <div class="voltage-line"><span class="voltage-label">CPU VCore:</span> <span class="voltage-value" id="volt-cpu">-- V</span></div> <div class="voltage-line"><span class="voltage-label">RAM VDDQ:</span> <span class="voltage-value" id="volt-ram">-- V</span></div> <div class="voltage-line"><span class="voltage-label">+12V Rail:</span> <span class="voltage-value" id="volt-12v">-- V</span></div> <div class="voltage-line"><span class="voltage-label">+5V Rail:</span> <span class="voltage-value" id="volt-5v">-- V</span></div> <div class="voltage-line"><span class="voltage-label">+3.3V Rail:</span> <span class="voltage-value" id="volt-3v">-- V</span></div> </div> <div class="widget-resize-handle"></div> </div>
  <!-- NOVÝ VĚTRÁČEK HTML -->
  <div id="fan-widget" class="widget">
      <div class="widget-header">Cooling Fan 01</div>
      <div class="widget-content">
            <div class="fan-visuals">
                <div class="fan-assembly-new no-drag">
                    <div class="fan-blade-new"></div>
                    <div class="fan-blade-new"></div>
                    <div class="fan-blade-new"></div>
                    <div class="fan-blade-new"></div>
                    <div class="fan-blade-new"></div>
                </div>
                <div class="fan-hub-new"></div>
            </div>
            <div id="fan-rpm" class="no-drag">---- RPM</div>
        </div>
      <div class="widget-resize-handle"></div>
  </div>
  <div id="usb-slots" class="widget no-resize"> <div class="widget-header">USB Ports</div> <div class="widget-content" style="flex-direction: column; gap: 15px;"> <div class="usb-slot-container"> <div class="usb-slot" id="usb-1"></div> <span class="usb-label" id="usb-label-1"></span> <a href="file:///media/pi/64%20GB" target="_blank" class="usb-link" id="usb-link-1">[Otevřít]</a> </div> <div class="usb-slot-container"> <div class="usb-slot" id="usb-2"></div> <span class="usb-label" id="usb-label-2"></span> <a href="file:///media/pi/Svazek%207%2C8%20GB" target="_blank" class="usb-link" id="usb-link-2">[Otevřít]</a> </div> <div class="usb-slot-container"> <div class="usb-slot" id="usb-3"></div> <span class="usb-label" id="usb-label-3"></span> <!-- <a href="#" target="_blank" class="usb-link" id="usb-link-3">[Otevřít]</a> --> </div> </div></div>
  <!-- *** NOVÉ WIDGETY v1.5 *** -->
  <div id="scratchpad-widget" class="widget"> <div class="widget-header">Quick Notes</div> <div class="widget-content"> <textarea id="scratchpad-textarea" class="no-drag" placeholder="Rychlé poznámky..."></textarea> <button id="scratchpad-clear-btn" title="Vymazat poznámky">Clear</button> </div> <div class="widget-resize-handle"></div> </div>
  <div id="converter-widget" class="widget"> <div class="widget-header">Unit Converter</div> <div class="widget-content"> <select id="converter-type" class="no-drag"> <option value="voltage">Napětí (V <-> mV)</option> <option value="current">Proud (A <-> mA)</option> <option value="resistance">Odpor (Ω <-> kΩ <-> MΩ)</option> <option value="capacitance">Kapacita (F <-> µF <-> nF <-> pF)</option> <option value="temperature">Teplota (°C <-> °F)</option> <option value="length">Délka (m <-> cm <-> mm <-> in)</option> </select> <div class="converter-row"> <input type="number" id="converter-input1" class="no-drag"> <select id="converter-unit1" class="no-drag"></select> <span class="converter-equals">=</span> <input type="number" id="converter-input2" class="no-drag"> <select id="converter-unit2" class="no-drag"></select> </div> <div id="converter-error" style="color: var(--neon-red); font-size: 12px; text-align: center; height: 15px;"></div> </div> <div class="widget-resize-handle"></div> </div>
  <div id="status-panel-widget" class="widget"> <div class="widget-header">System Status</div> <div id="status-items-container" class="widget-content"> <div class="status-item"> <span class="status-label">Main Power:</span> <span class="status-indicator" id="status-power">--</span> </div> <div class="status-item"> <span class="status-label">Core Logic:</span> <span class="status-indicator" id="status-core">--</span> </div> <div class="status-item"> <span class="status-label">Sensor Array:</span> <span class="status-indicator" id="status-sensor">--</span> </div> <div class="status-item"> <span class="status-label">Cooling Sys:</span> <span class="status-indicator" id="status-cooling">--</span> </div> <div class="status-item"> <span class="status-label">Data Link:</span> <span class="status-indicator" id="status-link">--</span> </div> <div class="status-item"> <span class="status-label">Security:</span> <span class="status-indicator" id="status-security">--</span> </div> </div> <div class="widget-resize-handle"></div> </div>

  <!-- Textový editor (MODAL) -->
  <div id="editor-modal"> <div class="editor-container"> <button class="close-button" onclick="toggleEditorModal()">×</button> <div class="editor-toolbar"> <select id="fontSelect" class="no-drag"> <option value="Arial">Arial</option> <!-- ... --> <option value="Ubuntu">Ubuntu</option> </select> <button onclick="format('bold')">Tučné</button> <button onclick="format('italic')">Kurzíva</button> <button onclick="format('underline')">Podtržení</button> </div> <div id="editor" class="editor-output no-drag" contenteditable="true"> Zde můžete psát své poznámky, dokumenty nebo cokoliv jiného... </div> <div class="save-as-container"> <input type="text" id="fileName" class="no-drag" placeholder="Zadejte název souboru" /> <button class="save-button" onclick="saveFile()">Uložit soubor</button> </div> </div> </div>


  <script>
    // --- KÓD PRO KALENDÁŘ (beze změny) ---
    /* ... Stejný kód ... */
     const calendarBar = document.getElementById('calendar-bar'); const calendarWidget = document.getElementById('calendar-widget'); const monthYearDisplay = document.getElementById('month-year'); const calendarDaysContainer = document.getElementById('calendar-days'); const prevMonthBtn = document.getElementById('prev-month'); const nextMonthBtn = document.getElementById('next-month'); const notesSection = document.getElementById('notes-section'); const notesHeader = document.getElementById('notes-header'); const noteTextarea = document.getElementById('note-textarea'); const saveNoteBtn = document.getElementById('save-note-btn'); let calendarCurrentDate = new Date(); let selectedDate = null; const monthNames = ["Leden", "Únor", "Březen", "Duben", "Květen", "Červen", "Červenec", "Srpen", "Září", "Říjen", "Listopad", "Prosinec"]; function saveNoteToLocalStorage(dateKey, note) { localStorage.setItem(`note-${dateKey}`, note); } function loadNoteFromLocalStorage(dateKey) { return localStorage.getItem(`note-${dateKey}`) || ""; } function generateCalendar(year, month) { const dayElements = calendarDaysContainer.querySelectorAll('.day, .other-month, div:not([class])'); dayElements.forEach(el => el.remove()); monthYearDisplay.textContent = `${monthNames[month]} ${year}`; const firstDayOfMonth = new Date(year, month, 1); const daysInMonth = new Date(year, month + 1, 0).getDate(); const startDayIndex = (firstDayOfMonth.getDay() + 6) % 7; const today = new Date(); const todayString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`; for (let i = 0; i < startDayIndex; i++) { calendarDaysContainer.appendChild(document.createElement('div')); } for (let day = 1; day <= daysInMonth; day++) { const dayDiv = document.createElement('div'); dayDiv.classList.add('day'); dayDiv.textContent = day; const currentDateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`; dayDiv.dataset.date = currentDateString; if (currentDateString === todayString) { dayDiv.classList.add('today'); } if (currentDateString === selectedDate) { dayDiv.classList.add('selected'); } dayDiv.addEventListener('click', () => { const previouslySelected = calendarDaysContainer.querySelector('.day.selected'); if(previouslySelected) { previouslySelected.classList.remove('selected'); } dayDiv.classList.add('selected'); selectedDate = currentDateString; notesHeader.textContent = `Poznámky pro: ${day}. ${monthNames[month]} ${year}`; noteTextarea.value = loadNoteFromLocalStorage(selectedDate); notesSection.classList.add('visible'); noteTextarea.focus(); }); calendarDaysContainer.appendChild(dayDiv); } const totalCells = startDayIndex + daysInMonth; const cellsToAdd = (7 * 6) - totalCells; for (let i = 0; i < cellsToAdd && totalCells + i < 42; i++) { const emptyDiv = document.createElement('div'); emptyDiv.classList.add('other-month'); calendarDaysContainer.appendChild(emptyDiv); } } function toggleCalendar() { calendarWidget.classList.toggle('visible'); if (!calendarWidget.classList.contains('visible')) { notesSection.classList.remove('visible'); const currentSelected = calendarDaysContainer.querySelector('.day.selected'); if (currentSelected) { currentSelected.classList.remove('selected'); } selectedDate = null; } } function updateCalendarBarDate() { const now = new Date(); const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' }; let formattedDate = now.toLocaleDateString('cs-CZ', options).toUpperCase(); formattedDate = formattedDate.replace(/,/g, ''); calendarBar.textContent = formattedDate; } calendarBar.addEventListener('click', toggleCalendar); prevMonthBtn.addEventListener('click', () => { calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() - 1); generateCalendar(calendarCurrentDate.getFullYear(), calendarCurrentDate.getMonth()); notesSection.classList.remove('visible'); selectedDate = null; }); nextMonthBtn.addEventListener('click', () => { calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() + 1); generateCalendar(calendarCurrentDate.getFullYear(), calendarCurrentDate.getMonth()); notesSection.classList.remove('visible'); selectedDate = null; }); saveNoteBtn.addEventListener('click', () => { if (selectedDate) { saveNoteToLocalStorage(selectedDate, noteTextarea.value); saveNoteBtn.textContent = "Uloženo!"; setTimeout(() => { saveNoteBtn.textContent = "Uložit poznámku"; }, 1500); } else { alert("Nejprve vyberte den."); } }); document.addEventListener('click', function(event) { const isClickInsideCalendar = calendarWidget.contains(event.target); const isClickOnBar = calendarBar.contains(event.target); if (!isClickInsideCalendar && !isClickOnBar && calendarWidget.classList.contains('visible')) { toggleCalendar(); } }); updateCalendarBarDate(); generateCalendar(calendarCurrentDate.getFullYear(), calendarCurrentDate.getMonth());

    // --- WIDGET DRAGGING & RESIZING (beze změny) ---
    /* ... Stejný kód ... */
     let activeWidget = null; let dragOffsetX = 0, dragOffsetY = 0; let isResizing = false; let resizeStartX = 0, resizeStartY = 0; let initialWidth = 0, initialHeight = 0; const MIN_WIDTH = 100; const MIN_HEIGHT = 50; function dragStart(e) { if (e.target.closest('.no-drag') || e.target.classList.contains('widget-resize-handle')) { return; } activeWidget = e.target.closest('.widget'); if (!activeWidget) return; dragOffsetX = e.clientX - activeWidget.getBoundingClientRect().left; dragOffsetY = e.clientY - activeWidget.getBoundingClientRect().top; activeWidget.classList.add('dragging'); document.addEventListener('mousemove', dragMove); document.addEventListener('mouseup', dragEnd); e.preventDefault(); } function dragMove(e) { if (!activeWidget || isResizing) return; let newTop = e.clientY - dragOffsetY; let newLeft = e.clientX - dragOffsetX; const widgetRect = activeWidget.getBoundingClientRect(); newTop = Math.max(0, Math.min(newTop, window.innerHeight - widgetRect.height - 5)); newLeft = Math.max(0, Math.min(newLeft, window.innerWidth - widgetRect.width - 5)); activeWidget.style.left = `${newLeft}px`; activeWidget.style.top = `${newTop}px`; } function dragEnd() { if (!activeWidget || isResizing) return; activeWidget.classList.remove('dragging'); saveWidgetState(activeWidget.id, activeWidget.style.top, activeWidget.style.left, activeWidget.style.width, activeWidget.style.height); activeWidget = null; document.removeEventListener('mousemove', dragMove); document.removeEventListener('mouseup', dragEnd); } function resizeStart(e) { activeWidget = e.target.closest('.widget'); if (!activeWidget || activeWidget.classList.contains('no-resize')) return; isResizing = true; resizeStartX = e.clientX; resizeStartY = e.clientY; initialWidth = activeWidget.offsetWidth; initialHeight = activeWidget.offsetHeight; document.addEventListener('mousemove', resizeMove); document.addEventListener('mouseup', resizeEnd); e.preventDefault(); e.stopPropagation(); } function resizeMove(e) { if (!isResizing || !activeWidget) return; const deltaX = e.clientX - resizeStartX; const deltaY = e.clientY - resizeStartY; let newWidth = Math.max(MIN_WIDTH, initialWidth + deltaX); let newHeight = Math.max(MIN_HEIGHT, initialHeight + deltaY); activeWidget.style.width = `${newWidth}px`; activeWidget.style.height = `${newHeight}px`; if (activeWidget.id === 'oscilloscope') { handleOscilloscopeResize(); } } function resizeEnd() { if (!isResizing || !activeWidget) return; isResizing = false; saveWidgetState(activeWidget.id, activeWidget.style.top, activeWidget.style.left, activeWidget.style.width, activeWidget.style.height); if (activeWidget.id === 'oscilloscope') { handleOscilloscopeResize(true); } activeWidget = null; document.removeEventListener('mousemove', resizeMove); document.removeEventListener('mouseup', resizeEnd); } function saveWidgetState(id, top, left, width, height) { if (!id) return; const state = JSON.parse(localStorage.getItem('widgetStates') || '{}'); state[id] = { top, left, width, height }; localStorage.setItem('widgetStates', JSON.stringify(state)); } function loadWidgetState() { const state = JSON.parse(localStorage.getItem('widgetStates') || '{}'); const visibilityCheckboxes = document.querySelectorAll('#widget-settings input[type="checkbox"][id^="show-"]'); document.querySelectorAll('.widget').forEach(widget => { if (widget.id && state[widget.id]) { const ws = state[widget.id]; if (ws.top) widget.style.top = ws.top; if (ws.left) widget.style.left = ws.left; if (ws.width) widget.style.width = ws.width; if (ws.height) widget.style.height = ws.height; if (widget.id === 'oscilloscope') { handleOscilloscopeResize(true); } } widget.addEventListener('mousedown', dragStart); const handle = widget.querySelector('.widget-resize-handle'); if (handle) { handle.addEventListener('mousedown', resizeStart); } const checkboxId = `show-${widget.id}`; const checkbox = document.getElementById(checkboxId); if (checkbox && !checkbox.checked) { widget.classList.add('hidden'); } }); const matrixCanvas = document.getElementById('matrix-rain-canvas'); const matrixCheckbox = document.getElementById('show-matrix'); if (matrixCanvas && matrixCheckbox && !matrixCheckbox.checked) { matrixCanvas.style.display = 'none'; } } function resetWidgetState() { if (confirm("Opravdu chcete resetovat pozice a velikosti všech widgetů na výchozí?")) { localStorage.removeItem('widgetStates'); window.location.reload(); } } document.addEventListener('DOMContentLoaded', loadWidgetState);

    // --- CRT TERMINAL (beze změny) ---
    /* ... Stejný kód ... */
    const crtContent = document.getElementById('crt-content'); const crtDate = document.getElementById('crt-date'); const crtTime = document.getElementById('crt-time'); const bootSequence = [ "Initializing BIOS...", "Memory Check: 16384 KB OK", "Detecting Primary Master... KARTOTEKA_HD v3.1", "Detecting Slave... None", "Initializing RetroNet Interface...", "IP Address: 192.168.0.42", "Loading Kernel Modules...", "Mounting /data partition...", "Starting System Services...", "Neon Lab Dashboard v1.8 Initialized.", "-----------------------------------", "Awaiting user interaction...", ]; const statusMessages = [ "Archive sync complete.", "User 'Elektromechanik' logged in.", "Checking data integrity...", "New entry added: Project Omega.", "Voltage levels stable.", "Network traffic nominal.", "Scheduled maintenance check passed.", "Disk space: 82% free.", "CPU Load: 18%" ]; let bootIndex = 0; let statusTimeout; function addCrtMessage(message, delay = 50) { return new Promise(resolve => { setTimeout(() => { const p = document.createElement('p'); p.textContent = `> ${message}`; crtContent.appendChild(p); crtContent.scrollTop = crtContent.scrollHeight; if (crtContent.children.length > 25) { crtContent.removeChild(crtContent.firstChild); } resolve(); }, delay); }); } async function runBootSequence() { for (const msg of bootSequence) { await addCrtMessage(msg, Math.random() * 150 + 50); } startStatusUpdates(); } function showRandomStatus() { const randomIndex = Math.floor(Math.random() * statusMessages.length); addCrtMessage(statusMessages[randomIndex]); const randomDelay = Math.random() * 15000 + 10000; statusTimeout = setTimeout(showRandomStatus, randomDelay); } function startStatusUpdates() { clearTimeout(statusTimeout); showRandomStatus(); } function updateCrtStatusLine() { const now = new Date(); const dateOptions = { day: '2-digit', month: '2-digit', year: 'numeric' }; const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }; crtDate.textContent = now.toLocaleDateString('cs-CZ', dateOptions); crtTime.textContent = now.toLocaleTimeString('cs-CZ', timeOptions); } runBootSequence(); setInterval(updateCrtStatusLine, 1000); updateCrtStatusLine();

    // --- STARÉ MĚŘÁKY (Gauge Cluster) - "Realistic" Simulation ---
    /* ... Stejný kód (včetně updateGaugesRealisticSim) ... */
    const gaugeTempValue = document.getElementById('gauge-temp-value'); const gaugeEnergyValue = document.getElementById('gauge-energy-value'); const gaugeSignalValue = document.getElementById('gauge-signal-value'); const gaugeTempBar = document.getElementById('gauge-temp'); const gaugeEnergyBar = document.getElementById('gauge-energy'); const gaugeSignalBar = document.getElementById('gauge-signal'); let currentTemp = 45; let currentEnergy = 80; let currentSignal = -75; let targetTemp = 45; let targetEnergy = 80; let targetSignal = -75; function updateGaugesRealisticSim() { if (Math.random() < 0.1) { targetTemp = 35 + Math.random() * 35; targetEnergy = 70 + Math.random() * 30; targetSignal = -85 + Math.random() * 30; } currentTemp += (targetTemp - currentTemp) * 0.1 + (Math.random() - 0.5) * 0.8; currentEnergy += (targetEnergy - currentEnergy) * 0.15 + (Math.random() - 0.5) * 1.5; currentSignal += (targetSignal - currentSignal) * 0.1 + (Math.random() - 0.5) * 1.2; currentTemp = Math.max(30, Math.min(currentTemp, 80)); currentEnergy = Math.max(50, Math.min(currentEnergy, 100)); currentSignal = Math.max(-95, Math.min(currentSignal, -50)); gaugeTempValue.textContent = `${Math.round(currentTemp)}°C`; gaugeEnergyValue.textContent = `${Math.round(currentEnergy)}%`; gaugeSignalValue.textContent = `${Math.round(currentSignal)}dB`; const tempNormalized = ((currentTemp - 30) / 50) * 100; const energyNormalized = currentEnergy; const signalNormalized = ((currentSignal + 100) / 50) * 100; gaugeTempBar.style.height = `${Math.max(0, Math.min(100, tempNormalized))}%`; gaugeEnergyBar.style.height = `${Math.max(0, Math.min(100, energyNormalized))}%`; gaugeSignalBar.style.height = `${Math.max(0, Math.min(100, signalNormalized))}%`; } setInterval(updateGaugesRealisticSim, 1500); updateGaugesRealisticSim();

    // --- OSCILOSKOP (beze změny kreslení) ---
    /* ... Stejný kód (včetně drawOscilloscope a handleOscilloscopeResize) ... */
     const oscCanvas = document.getElementById('osc-canvas'); const oscCtx = oscCanvas.getContext('2d'); let oscWidth = oscCanvas.offsetWidth; let oscHeight = oscCanvas.offsetHeight; let oscTime = 0; let oscRAF; function drawOscilloscope() { oscCtx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--retro-bg-color').trim(); oscCtx.fillRect(0, 0, oscWidth, oscHeight); oscCtx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--neon-green').trim(); oscCtx.lineWidth = 2; oscCtx.shadowBlur = 8; oscCtx.shadowColor = getComputedStyle(document.documentElement).getPropertyValue('--neon-green-glow').trim(); oscCtx.beginPath(); oscCtx.moveTo(0, oscHeight / 2); for (let x = 0; x < oscWidth; x++) { const noise = (Math.random() - 0.5) * (oscHeight / 15); const sineWave = Math.sin(x * 0.05 + oscTime) * (oscHeight / 3.5); const sineWave2 = Math.sin(x * 0.15 + oscTime * 0.5) * (oscHeight / 10); const y = oscHeight / 2 + sineWave + sineWave2 + noise; oscCtx.lineTo(x, y); } oscCtx.stroke(); oscCtx.shadowBlur = 0; oscTime += 0.08; oscRAF = requestAnimationFrame(drawOscilloscope); } let resizeTimeoutOsc; function handleOscilloscopeResize(forceUpdate = false) { clearTimeout(resizeTimeoutOsc); resizeTimeoutOsc = setTimeout(() => { const newWidth = oscCanvas.offsetWidth; const newHeight = oscCanvas.offsetHeight; if (forceUpdate || newWidth !== oscWidth || newHeight !== oscHeight) { oscWidth = newWidth; oscHeight = newHeight; oscCanvas.width = oscWidth; oscCanvas.height = oscHeight; } }, forceUpdate ? 0 : 100); } requestAnimationFrame(drawOscilloscope);

    // --- PIXEL HODINY (beze změny) ---
    /* ... Stejný kód ... */
    const pixelClock = document.getElementById('pixel-clock'); function updatePixelClock() { const now = new Date(); const hours = String(now.getHours()).padStart(2, '0'); const minutes = String(now.getMinutes()).padStart(2, '0'); const seconds = String(now.getSeconds()).padStart(2, '0'); pixelClock.textContent = `${hours}:${minutes}:${seconds}`; } setInterval(updatePixelClock, 1000); updatePixelClock();

    // --- TEXTOVÝ EDITOR (Modal funkce - beze změny) ---
    /* ... Stejný kód ... */
    const editorModal = document.getElementById('editor-modal'); function toggleEditorModal() { editorModal.classList.toggle('visible'); } function format(command) { document.execCommand(command, false, null); } document.getElementById("fontSelect").addEventListener("change", function () { document.execCommand("fontName", false, this.value); document.getElementById('editor').focus(); }); function saveFile() { const content = document.getElementById("editor").innerHTML; const fileName = document.getElementById("fileName").value || 'dokument'; const blob = new Blob([content], { type: 'text/html' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = fileName + '.html'; link.click(); URL.revokeObjectURL(link.href); } editorModal.addEventListener('click', function(event) { if (event.target === editorModal) { toggleEditorModal(); } });

    // --- MENU NASTAVENÍ (funkce - beze změny) ---
    /* ... Stejný kód (včetně resetWidgetState) ... */
     const settingsMenu = document.getElementById('settingsMenu'); function toggleSettingsMenu() { settingsMenu.classList.toggle('open'); } function toggleSubmenu(submenuId) { const submenu = document.getElementById(submenuId); const allSubmenus = settingsMenu.querySelectorAll('.settings-submenu'); allSubmenus.forEach(sub => { if (sub !== submenu) sub.classList.remove('open'); }); if (submenu) submenu.classList.toggle('open'); }
     function toggleWidgetVisibility(widgetId, isVisible) { // Opravená funkce
        const widget = document.getElementById(widgetId);
        if (widget) {
            if (widgetId === 'matrix-rain-canvas') { // Speciální případ pro canvas
                widget.style.display = isVisible ? 'block' : 'none';
            } else {
                 if (isVisible) {
                     widget.classList.remove('hidden');
                 } else {
                     widget.classList.add('hidden');
                 }
            }
            console.log(`Widget ${widgetId} visibility set to ${isVisible ? 'visible' : 'hidden'}`);
            // Zde by se měl uložit stav (např. do localStorage), což není implementováno
            // localStorage.setItem(`widgetVisible_${widgetId}`, isVisible);
        } else {
            console.warn(`Widget with ID ${widgetId} not found for visibility toggle.`);
        }
    }
     function clearCalendarNotes() { if (confirm("Opravdu chcete smazat všechny uložené poznámky v kalendáři?")) { Object.keys(localStorage).forEach(key => { if (key.startsWith('note-')) { localStorage.removeItem(key); } }); alert("Poznámky vymazány."); if (selectedDate) { noteTextarea.value = ""; } } } function clearScratchpad() { if (confirm("Opravdu chcete smazat obsah Scratchpadu?")) { const scratchpad = document.getElementById('scratchpad-textarea'); if (scratchpad) scratchpad.value = ''; localStorage.removeItem('scratchpadContent'); alert("Scratchpad vymazán."); } } document.addEventListener('click', function(event) { const settingsIcon = document.querySelector('.settings-icon'); const isClickInsideMenu = settingsMenu.contains(event.target); const isClickOnIcon = settingsIcon.contains(event.target); if (!isClickInsideMenu && !isClickOnIcon && settingsMenu.classList.contains('open')) { toggleSettingsMenu(); settingsMenu.querySelectorAll('.settings-submenu').forEach(sub => sub.classList.remove('open')); } });
     // Načtení viditelnosti při startu (volitelné, pokud implementujeme ukládání)
     /* document.addEventListener('DOMContentLoaded', () => {
         document.querySelectorAll('#widget-settings input[type="checkbox"]').forEach(cb => {
             const widgetId = cb.id.replace('show-', '');
             const isVisible = localStorage.getItem(`widgetVisible_${widgetId}`) !== 'false'; // Načíst stav
             cb.checked = isVisible;
             toggleWidgetVisibility(widgetId, isVisible); // Aplikovat stav
         });
     }); */


    // --- NOVÉ WIDGETY (JS v1.5 a Fan RPM) ---

    // Matrix Rain (beze změny)
    /* ... Stejný kód ... */
     const matrixCanvas = document.getElementById('matrix-rain-canvas'); const matrixCtx = matrixCanvas.getContext('2d'); matrixCanvas.width = window.innerWidth; matrixCanvas.height = window.innerHeight; const matrixChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%+-/~{[|`]}"; const matrixFontSize = 16; const matrixColumns = Math.floor(matrixCanvas.width / matrixFontSize); const matrixDrops = Array(matrixColumns).fill(1); function drawMatrix() { matrixCtx.fillStyle = 'rgba(2, 4, 2, 0.05)'; matrixCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height); matrixCtx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--neon-green').trim(); matrixCtx.font = `${matrixFontSize}px monospace`; for (let i = 0; i < matrixDrops.length; i++) { const text = matrixChars[Math.floor(Math.random() * matrixChars.length)]; matrixCtx.fillText(text, i * matrixFontSize, matrixDrops[i] * matrixFontSize); if (matrixDrops[i] * matrixFontSize > matrixCanvas.height && Math.random() > 0.975) { matrixDrops[i] = 0; } matrixDrops[i]++; } } setInterval(drawMatrix, 40); window.addEventListener('resize', () => { matrixCanvas.width = window.innerWidth; matrixCanvas.height = window.innerHeight; });

    // Neon Voltage Meter (beze změny)
    /* ... Stejný kód ... */
     const voltCpu = document.getElementById('volt-cpu'); const voltRam = document.getElementById('volt-ram'); const volt12v = document.getElementById('volt-12v'); const volt5v = document.getElementById('volt-5v'); const volt3v = document.getElementById('volt-3v'); function updateVoltages() { voltCpu.textContent = (1.15 + (Math.random() - 0.5) * 0.04).toFixed(2) + ' V'; voltRam.textContent = (1.35 + (Math.random() - 0.5) * 0.02).toFixed(2) + ' V'; volt12v.textContent = (12.0 + (Math.random() - 0.5) * 0.15).toFixed(2) + ' V'; volt5v.textContent = (5.0 + (Math.random() - 0.5) * 0.08).toFixed(2) + ' V'; volt3v.textContent = (3.3 + (Math.random() - 0.5) * 0.05).toFixed(2) + ' V'; } setInterval(updateVoltages, 1800); updateVoltages();

    // USB Slots (Pevné názvy + Odkaz - beze změny)
    /* ... Stejný kód ... */
    const usbSlotsContainers = document.querySelectorAll('.usb-slot-container'); const usbFixedNames = { 'usb-1': 'Recalbox', 'usb-2': 'Free Data', 'usb-3': 'External HDD' }; const usbOccupiedState = {}; usbSlotsContainers.forEach((container, index) => { const slot = container.querySelector('.usb-slot'); const label = container.querySelector('.usb-label'); const link = container.querySelector('.usb-link'); const slotId = slot.id; if (label) label.style.display = 'none'; if (link) link.style.display = 'none'; slot.addEventListener('click', (e) => { e.stopPropagation(); const isOccupied = slot.classList.toggle('occupied'); usbOccupiedState[slotId] = isOccupied; const deviceName = usbFixedNames[slotId] || `USB Port ${slotId.split('-')[1]}`; if (isOccupied) { if (label) { label.textContent = deviceName; label.style.display = 'inline'; } if (link) { link.style.display = 'inline'; } addCrtMessage(`USB Port ${slotId.split('-')[1]}: Zařízení připojeno (${deviceName}).`); } else { const disconnectedName = deviceName; if (label) { label.textContent = ''; label.style.display = 'none'; } if (link) { link.style.display = 'none'; } addCrtMessage(`USB Port ${slotId.split('-')[1]}: Zařízení odpojeno (${disconnectedName}).`); } }); if (label) label.addEventListener('mousedown', e => e.stopPropagation()); if (link) link.addEventListener('mousedown', e => e.stopPropagation()); });

    // Scratchpad (beze změny)
    /* ... Stejný kód ... */
    const scratchpadTextarea = document.getElementById('scratchpad-textarea'); const scratchpadClearBtn = document.getElementById('scratchpad-clear-btn'); scratchpadTextarea.value = localStorage.getItem('scratchpadContent') || ''; let scratchpadTimeout; scratchpadTextarea.addEventListener('input', () => { clearTimeout(scratchpadTimeout); scratchpadTimeout = setTimeout(() => { localStorage.setItem('scratchpadContent', scratchpadTextarea.value); }, 500); });
    // Tlačítko clear je nyní součástí widgetu a volá funkci z menu nastavení
    scratchpadClearBtn.addEventListener('click', clearScratchpad);


    // Unit Converter (beze změny)
    /* ... Stejný kód ... */
    const converterTypeSelect = document.getElementById('converter-type'); const converterInput1 = document.getElementById('converter-input1'); const converterUnit1Select = document.getElementById('converter-unit1'); const converterInput2 = document.getElementById('converter-input2'); const converterUnit2Select = document.getElementById('converter-unit2'); const converterError = document.getElementById('converter-error'); const units = { voltage: { V: 1, mV: 0.001 }, current: { A: 1, mA: 0.001 }, resistance: { MΩ: 1000000, kΩ: 1000, Ω: 1 }, capacitance: { F: 1, µF: 1e-6, nF: 1e-9, pF: 1e-12 }, temperature: { '°C': 'c', '°F': 'f' }, length: { m: 1, cm: 0.01, mm: 0.001, 'in': 0.0254 } }; function populateUnits() { const type = converterTypeSelect.value; const unitSet = units[type]; converterUnit1Select.innerHTML = ''; converterUnit2Select.innerHTML = ''; Object.keys(unitSet).forEach(unit => { const option1 = document.createElement('option'); option1.value = unit; option1.textContent = unit; converterUnit1Select.appendChild(option1); const option2 = document.createElement('option'); option2.value = unit; option2.textContent = unit; converterUnit2Select.appendChild(option2); }); if (converterUnit1Select.options.length > 1) { converterUnit2Select.selectedIndex = 1; } convertUnits(); } function convertUnits(sourceInput = 1) { const type = converterTypeSelect.value; const unitSet = units[type]; const val1 = parseFloat(converterInput1.value); const val2 = parseFloat(converterInput2.value); const unit1 = converterUnit1Select.value; const unit2 = converterUnit2Select.value; converterError.textContent = ''; try { if (type === 'temperature') { if (sourceInput === 1 && !isNaN(val1)) { if (unit1 === '°C' && unit2 === '°F') converterInput2.value = ((val1 * 9/5) + 32).toFixed(2); else if (unit1 === '°F' && unit2 === '°C') converterInput2.value = ((val1 - 32) * 5/9).toFixed(2); else converterInput2.value = val1.toFixed(2); } else if (sourceInput === 2 && !isNaN(val2)) { if (unit2 === '°C' && unit1 === '°F') converterInput1.value = ((val2 * 9/5) + 32).toFixed(2); else if (unit2 === '°F' && unit1 === '°C') converterInput1.value = ((val2 - 32) * 5/9).toFixed(2); else converterInput1.value = val2.toFixed(2); } } else { const factor1 = unitSet[unit1]; const factor2 = unitSet[unit2]; if (sourceInput === 1 && !isNaN(val1)) { const baseValue = val1 * factor1; converterInput2.value = (baseValue / factor2).toPrecision(4); } else if (sourceInput === 2 && !isNaN(val2)) { const baseValue = val2 * factor2; converterInput1.value = (baseValue / factor1).toPrecision(4); } } } catch (e) { console.error("Conversion error:", e); converterError.textContent = "Chyba převodu"; } } converterTypeSelect.addEventListener('change', populateUnits); converterInput1.addEventListener('input', () => convertUnits(1)); converterUnit1Select.addEventListener('change', () => convertUnits(1)); converterInput2.addEventListener('input', () => convertUnits(2)); converterUnit2Select.addEventListener('change', () => convertUnits(2)); populateUnits();

    // Status Panel (beze změny)
    /* ... Stejný kód ... */
    const statusIndicators = { power: document.getElementById('status-power'), core: document.getElementById('status-core'), sensor: document.getElementById('status-sensor'), cooling: document.getElementById('status-cooling'), link: document.getElementById('status-link'), security: document.getElementById('status-security') }; const possibleStatuses = [ { text: 'ONLINE', class: 'status-ok' }, { text: 'ACTIVE', class: 'status-ok' }, { text: 'OK', class: 'status-ok' }, { text: 'IDLE', class: 'status-warn' }, { text: 'WARN', class: 'status-warn' }, { text: 'ERROR', class: 'status-error' }, { text: 'OFFLINE', class: 'status-error' }, { text: 'INIT', class: 'status-idle'} ]; function updateStatusPanel() { Object.values(statusIndicators).forEach(indicator => { if (!indicator) return; const isLikelyOk = Math.random() > 0.2; let finalStatus; if (isLikelyOk) { const okStatuses = possibleStatuses.filter(s => s.class === 'status-ok'); finalStatus = okStatuses[Math.floor(Math.random() * okStatuses.length)]; } else { const notOkStatuses = possibleStatuses.filter(s => s.class !== 'status-ok'); finalStatus = notOkStatuses[Math.floor(Math.random() * notOkStatuses.length)]; } indicator.textContent = finalStatus.text; indicator.className = 'status-indicator'; indicator.classList.add(finalStatus.class); }); } setInterval(updateStatusPanel, 3500); updateStatusPanel();

    // Fan RPM Simulation (beze změny)
    /* ... Stejný kód ... */
    const fanRpmElement = document.getElementById('fan-rpm'); let currentRpm = 1500; let targetRpm = 1500; function updateFanRpm() { if (Math.random() < 0.05) { targetRpm = 1200 + Math.random() * 800; } currentRpm += (targetRpm - currentRpm) * 0.05 + (Math.random() - 0.5) * 20; currentRpm = Math.max(800, Math.min(currentRpm, 2500)); if(fanRpmElement) { fanRpmElement.textContent = `${Math.round(currentRpm)} RPM`; } } setInterval(updateFanRpm, 1000); updateFanRpm();

  </script>
</body>
</html>
